<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reports</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>Query Reports</h1>

  <!-- Navigation -->
  <nav>
    <a href="/">Home</a>
    <a href="/clublocation.html">Club Locations</a>
    <a href="/personnel.html">Personnel</a>
    <a href="/clubmember.html">Club Members</a>
    <a href="/familymember.html">Family Members</a>
    <a href="/payment.html">Payments</a>
    <a href="/team.html">Teams</a>
    <a href="/player.html">Players</a>
    <a href="/email.html">Email Logs</a>
    <a href="/reports.html" class="active">Reports</a>
  </nav>
  
  <div class="query-buttons">
    <button data-query-id="7" onclick="runQuery(7)">7. Get complete details for every location in the system.</button>
    <button data-query-id="8" onclick="runQuery(8)">8. Get Details for Family Members and Club Members Associated with Them.</button>
    <button data-query-id="9" onclick="runQuery(9)">9. Get Details of All Teams' Formations Recorded in the System for a Given Location and Week.</button>
    <button data-query-id="10" onclick="runQuery(10)">Get Teams</button>
  </div>
  
  <div id="loading" class="loading">Loading data...</div>
  <div id="error" class="error" style="display: none;"></div>
  <div id="status" class="status"></div>
  

  <table id="results">
    <thead>
        <tr id="headers"></tr>
    </thead>
    <tbody id="data"></tbody>
</table>

  <script>
  function runQuery(queryId) {
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const status = document.getElementById('status');
    const results = document.getElementById('results');

  // Reset UI
  loading.style.display = 'block';
  error.style.display = 'none';
  results.innerHTML = '';
  status.textContent = `Executing query ${queryId}...`;

  let response;

  fetch(`/api/run-query?id=${queryId}`)
  .then(function (response) {
                    if (!response.ok) throw new Error("Network error");
                    return response.json();
                })
                .then(function (data) {
                    allData = data;
                    displayData(data);
                })
                .catch(function (error) {
                    console.error("Error:", error);
                    document.getElementById('data').innerHTML =
                        '<tr><td colspan="13">Failed to load data. Check console.</td></tr>';
                });

  function displayData(data) {
    const headersRow = document.getElementById('headers');
    const tableBody = document.getElementById('data');

    if (!headersRow || !tableBody) {
        console.error("Error: Table elements not found");
        return;
    }

            // Clear existing content
            headersRow.innerHTML = '';
            tableBody.innerHTML = '';

            // Add headers (if data exists)
    if (!data || data.length === 0) {
      console.warn("No data received from API.");
      tableBody.innerHTML = '<tr><td colspan="13">No data available</td></tr>';
      return;
    }

                // Add action column header
                const actionTh = document.createElement('th');
                actionTh.textContent = 'Actions';
                headersRow.appendChild(actionTh);
            

            // Add rows
            data.forEach(function (row, index) {
                const tr = document.createElement('tr');
                tr.dataset.location_id = row.location_id || index; // Assuming there's an location_id field

                Object.values(row).forEach(function (value) {
                    const td = document.createElement('td');
                    td.textContent = (value === null) ? 'NULL' : value;
                    tr.appendChild(td);
                });

                // Add action buttons
                const actionTd = document.createElement('td');



                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.onclick = function () { editRow(row); };

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = function () { deleteRow(row); };

                actionTd.appendChild(editBtn);
                actionTd.appendChild(deleteBtn);
                tr.appendChild(actionTd);

                tableBody.appendChild(tr);
            });
        }
  }



    </script>
  </body>
</html>
